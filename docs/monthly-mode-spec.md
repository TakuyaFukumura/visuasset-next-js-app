# 資産推移画面 月次モード 仕様書

## 概要

現在の資産推移画面（`/`）は年次データのみを棒グラフで表示しているが、月次データを折れ線グラフで表示する「月次モード」を追加する。
年次モードと月次モードは画面内のトグルボタンで切り替えられるようにする。

---

## 画面構成

```
┌─────────────────────────────────┐
│  資産推移                         │
│  [年次] [月次]  ← 切り替えトグル    │
├─────────────────────────────────┤
│  グラフ                           │
│  （年次：積み上げ棒グラフ）           │
│  （月次：折れ線グラフ）              │
├─────────────────────────────────┤
│  データテーブル                    │
│  （年次：年・各ジャンル・合計）        │
│  （月次：年月・各ジャンル・合計）      │
└─────────────────────────────────┘
```

---

## データ仕様

### 年次データ（既存）

- ファイル：`data/assets.csv`
- フォーマット：`year,stocks,cash,crypto`

### 月次データ（新規追加）

- ファイル：`data/assets_monthly.csv`
- フォーマット：`year,month,stocks,cash,crypto`
  - `year`：西暦年（数値）
  - `month`：月（1〜12 の数値）
  - `stocks`：株式（万円）
  - `cash`：現預金（万円）
  - `crypto`：暗号資産（万円）

#### サンプルデータ

```csv
year,month,stocks,cash,crypto
2024,1,750,150,35
2024,2,760,150,36
2024,3,770,150,37
2024,4,775,150,38
2024,6,780,150,38
2024,7,790,150,39
2024,9,800,150,40
2024,10,803,150,40
2024,12,807,150,40
2025,1,820,150,40
2025,2,835,150,40
2025,3,850,150,40
2025,4,865,150,40
2025,6,880,150,40
2025,9,910,150,40
2025,12,1058,150,40
```

> **注意**：途中の月（例：5月、8月、11月など）が欠けていても正常に動作するものとする。

---

## 欠損月の扱い

- 途中の月のデータが欠けている場合は、その月を**スキップ**してグラフ・テーブルに表示する。
- 欠損月を補完（線形補間など）する処理は行わない。
- グラフ（折れ線）は実際にデータが存在する月のみをプロットし、折れ線で繋ぐ。

---

## グラフ仕様

### 年次モード（既存）

- グラフ種別：積み上げ棒グラフ（`BarChart`）
- X 軸：年（`year`）
- Y 軸：資産額（万円）
- 変更なし

### 月次モード（新規）

- グラフ種別：折れ線グラフ（`LineChart`）
- X 軸：年月（`YYYY/MM` 形式、例：`2024/01`）
- Y 軸：資産額（万円）
- 各ジャンル（株式・現預金・暗号資産）を別々の折れ線で表示する
- 凡例・ツールチップは年次モードと同様に表示する
- Recharts の `LineChart` コンポーネントを使用する

---

## UI 仕様

### 切り替えトグル

- 表示位置：グラフ・テーブルの上部
- 選択肢：「年次」「月次」の 2 択
- デフォルト：「年次」
- 選択中の項目はボタンをアクティブ状態（色を変えるなど）で示す

#### ワイヤーフレーム

```
資産推移
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  [年次（選択中）] [月次]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  [グラフエリア]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  [テーブルエリア]
```

---

## テーブル仕様

### 年次モード（既存）

| 年 | 株式（万円） | 現預金（万円） | 暗号資産（万円） | 合計（万円） |
|---|-----------|------------|--------------|-----------|
| 2024 | 807 | 150 | 40 | 997 |

### 月次モード（新規）

| 年月 | 株式（万円） | 現預金（万円） | 暗号資産（万円） | 合計（万円） |
|-----|-----------|------------|--------------|-----------|
| 2024/01 | 750 | 150 | 35 | 935 |
| 2024/02 | 760 | 150 | 36 | 946 |

- 欠損月の行は表示しない
- 年月は `YYYY/MM` 形式で表示する

---

## 技術方針

### 新規ファイル

| ファイル                              | 用途                         |
|-------------------------------------|------------------------------|
| `data/assets_monthly.csv`           | 月次サンプルデータ              |
| `lib/parseMonthlyAssets.ts`         | 月次 CSV のパース処理           |
| `src/app/components/AssetMonthlyChart.tsx` | 月次折れ線グラフコンポーネント |
| `src/app/components/AssetMonthlyTable.tsx` | 月次データテーブルコンポーネント |

### 変更ファイル

| ファイル                    | 変更内容                              |
|---------------------------|--------------------------------------|
| `src/app/page.tsx`        | 切り替えトグルの追加、モードに応じた表示切替 |

### データ型定義

```typescript
// lib/parseMonthlyAssets.ts に追加
export interface MonthlyAssetData {
    year: number;
    month: number;
    stocks: number;
    cash: number;
    crypto: number;
}
```

### 状態管理

- 切り替えモードは `useState` で管理する（`'yearly' | 'monthly'`）
- サーバーへの保存は行わない

### パース処理の方針

- `lib/parseMonthlyAssets.ts` を新規作成し、`data/assets_monthly.csv` を読み込む
- ヘッダーは `year,month,stocks,cash,crypto` 固定とする
  - 先頭行のヘッダーがこの順序・この名称と完全一致しない場合は **パースエラー** とする
- 各行は 5 列（`year,month,stocks,cash,crypto`）であることを前提とし、列数が不足・過剰な行は **パースエラー** とする
- 各列は以下の条件で数値変換し、満たさない場合は **パースエラー** とする
  - `year`, `month`, `stocks`, `cash`, `crypto` はすべて数値に変換可能であること（`NaN` にならないこと）
  - `month` は 1〜12 の整数であること
  - `year` は 0 より大きい整数（自然数）であること（将来的に必要であれば範囲を見直す）
- パースエラー発生時の扱い
  - `parseAssets()` と同様に、パース関数内で例外（`throw`）を投げる方針とする
  - 画面側ではこの例外を捕捉し、「月次データの読み込みに失敗しました」等のエラーメッセージを表示する（グラフは描画しない）
- データが存在する行のみをパースし、欠損月は自動的に除外される（特別な処理は不要）
- 年・月の昇順でソートして返す

---

## 関連ドキュメント

- [機能追加案](./feature-proposals.md)
